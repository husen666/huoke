# 客服中心 & 知识库 & AI 引擎 - 详细功能规格

## 1. 统一消息收件箱

### 1.1 多渠道消息聚合

所有渠道的客户消息统一汇入一个收件箱：

| 渠道 | 消息类型 | 接入方式 |
|------|---------|---------|
| 企业微信 | 文字、图片、语音、视频、文件、小程序 | 企微回调 |
| 钉钉 | 文字、图片、文件、卡片 | 钉钉事件订阅 |
| 抖音私信 | 文字、图片、视频 | 抖音 Webhook |
| 小红书 | 文字、图片 | 小红书 API |
| 网站在线客服 | 文字、图片、文件 | WebSocket |
| 表单提交 | 结构化数据 | HTTP Webhook |
| 邮件 | 富文本、附件 | IMAP/SMTP |
| 短信 | 文字 | 短信网关 API |

### 1.2 收件箱功能

#### 会话列表
```
┌─────────────────────────────────────────────────────────────────┐
│ 收件箱                                                          │
├──────────┬──────────────────────────────────────────────────────┤
│ 筛选     │ 会话列表                        │ 对话详情            │
│          │                                │                    │
│ [全部 28]│ 🔴 张三 (企微) 2min前           │ 张三 - 企业微信      │
│ [我的 12]│ "这个价格能优惠吗？"            │ 🏢 张三科技 | 85分   │
│ [未分配8]│                                │ ──────────────────  │
│ [机器人5]│ 🟡 李四 (抖音) 15min前          │ 👤 14:20            │
│ [已解决3]│ "怎么购买你们产品"              │ 你好，看到你们抖音    │
│          │                                │ 上的产品很感兴趣     │
│ 渠道     │ 🟢 王五 (小红书) 1h前           │                    │
│ [企微 10]│ "收到，谢谢！"                  │ 🤖 14:20 (AI)       │
│ [抖音 8] │                                │ 您好！很高兴为您服   │
│ [小红书6]│ ⚪ 赵六 (网站) 3h前             │ 务。请问您对哪款产   │
│ [其他 4] │ "已解决，感谢"                  │ 品感兴趣呢？        │
│          │                                │                    │
│ 标签     │                                │ 👤 14:21            │
│ [价格咨询]│                               │ 就是那个企业版的     │
│ [售后问题]│                               │                    │
│ [技术支持]│                               │ 🤖 14:21 (AI)       │
│          │                                │ 企业版功能包括...    │
│          │                                │ [查看AI建议回复]     │
│          │                                │                    │
│          │                                │ ┌──────────────┐   │
│          │                                │ │ 输入消息...    │   │
│          │                                │ │ [AI] [模板] [📎]│  │
│          │                                │ └──────────────┘   │
├──────────┴────────────────────────────────┼────────────────────┤
│                                           │ 客户信息侧栏        │
│                                           │ 📋 客户卡片         │
│                                           │ 🏷️ 标签            │
│                                           │ 📊 历史记录         │
│                                           │ 🧠 AI 记忆         │
│                                           │ 📝 内部备注         │
└───────────────────────────────────────────┴────────────────────┘
```

### 1.3 消息处理能力

#### 智能路由引擎
```yaml
路由规则（优先级从高到低）：

1. VIP 客户路由
   条件: customer.tags CONTAINS "VIP"
   动作: 分配给 → VIP专属客服组
   
2. 技能匹配路由
   条件: message.intent = "技术问题"
   动作: 分配给 → 技术支持组
   
3. 地域路由
   条件: customer.region = "华东"
   动作: 分配给 → 华东客服组
   
4. 负载均衡路由
   条件: 默认
   动作: 分配给 → 当前空闲且技能匹配的客服
```

#### 会话状态机
```
         ┌──── 超时关闭 ────┐
         │                  │
新消息 → 等待中 → 进行中 → 已解决 → 已关闭
              ↑      │         │
              └──────┘         │
           客户追问             │
              ↑                │
              └────────────────┘
               重新打开
```

---

## 2. AI 智能客服引擎

### 2.1 DeepSeek 集成架构

```
客户消息
    │
    ▼
┌──────────┐
│ 预处理    │ ← 消息清洗、语言检测、敏感词过滤
└────┬─────┘
     │
     ▼
┌──────────┐     ┌──────────┐
│ 意图识别  │────▶│ DeepSeek │ ← 识别客户意图类型
│          │     │   V3     │
└────┬─────┘     └──────────┘
     │
     ├──── 简单问题 ────┐
     │                  │
     │                  ▼
     │           ┌──────────┐     ┌──────────┐
     │           │ RAG 检索  │────▶│ Qdrant   │
     │           │ 知识库    │     │ 向量库   │
     │           └────┬─────┘     └──────────┘
     │                │
     │                ▼
     │           ┌──────────┐     ┌──────────┐
     │           │ 回复生成  │────▶│ DeepSeek │
     │           │          │     │   V3     │
     │           └────┬─────┘     └──────────┘
     │                │
     │                ▼
     │           AI 自动回复
     │
     ├──── 复杂问题 ────────▶ 转人工客服 (AI辅助)
     │
     └──── 情绪异常 ────────▶ 紧急升级 + 通知主管
```

### 2.2 意图识别分类

| 一级意图 | 二级意图 | 处理方式 | 示例 |
|---------|---------|---------|------|
| 产品咨询 | 功能了解 | AI 回复 | "你们产品有什么功能？" |
| 产品咨询 | 价格咨询 | AI 回复 + 通知销售 | "企业版多少钱？" |
| 产品咨询 | 对比竞品 | AI 回复 | "跟XX产品比有什么优势？" |
| 售前服务 | 申请试用 | 创建商机 + 分配销售 | "我想试用一下" |
| 售前服务 | 预约演示 | 自动排程 + 通知 | "能安排个演示吗？" |
| 售后服务 | 使用问题 | AI 回复 (知识库) | "怎么设置XXX？" |
| 售后服务 | 故障报修 | 创建工单 + 转技术 | "系统报错了" |
| 售后服务 | 退款/投诉 | 升级处理 + 通知主管 | "我要退款" |
| 闲聊 | 问候 | AI 回复 | "你好" |
| 闲聊 | 其他 | AI 回复 | "今天天气不错" |

### 2.3 DeepSeek 调用策略

```typescript
// 模型选择策略
const modelStrategy = {
  // 简单问答：DeepSeek-V3 (快速、低成本)
  simple_qa: {
    model: "deepseek-chat",
    temperature: 0.3,
    max_tokens: 500,
  },
  
  // 复杂推理：DeepSeek-R1 (深度思考)
  complex_reasoning: {
    model: "deepseek-reasoner",
    temperature: 0.1,
    max_tokens: 2000,
  },
  
  // 创意营销：DeepSeek-V3 (较高创造力)
  creative_marketing: {
    model: "deepseek-chat",
    temperature: 0.8,
    max_tokens: 1000,
  },
  
  // 数据分析：DeepSeek-R1 (精确分析)
  data_analysis: {
    model: "deepseek-reasoner",
    temperature: 0,
    max_tokens: 3000,
  },
};
```

### 2.4 AI 回复质量控制

```
回复生成 → 安全检查 → 相关性评分 → 置信度判断 → 决策
                                                  │
                                        ┌─────────┼─────────┐
                                        │         │         │
                                    置信度>80%  50-80%    <50%
                                        │         │         │
                                    直接回复   建议回复   转人工
                                    (自动)    (人工确认) (立即)
```

### 2.5 人机协作模式

| 模式 | 说明 | 适用场景 |
|------|------|---------|
| 全自动 | AI 独立回复，人工监控 | 常见FAQ、简单咨询 |
| 半自动 | AI 生成草稿，人工审核后发送 | 价格谈判、复杂需求 |
| AI 辅助 | 人工回复，AI 提供建议和知识 | VIP客户、投诉处理 |
| 纯人工 | 人工全程处理 | 紧急事件、敏感话题 |

---

## 3. 知识库管理

### 3.1 知识库结构

```
企业知识库
├── 📁 产品知识
│   ├── 📁 产品A
│   │   ├── 📄 产品介绍.pdf
│   │   ├── 📄 功能手册.docx
│   │   ├── 📄 定价方案.xlsx
│   │   └── 📄 竞品对比.md
│   ├── 📁 产品B
│   │   └── ...
│   └── 📁 产品C
│       └── ...
├── 📁 销售知识
│   ├── 📄 销售话术库.docx
│   ├── 📄 常见异议处理.md
│   ├── 📄 成功案例集.pdf
│   └── 📄 报价策略.xlsx
├── 📁 客服知识
│   ├── 📄 FAQ 常见问题.md
│   ├── 📄 故障排查手册.pdf
│   ├── 📄 操作指南.docx
│   └── 📄 退换货政策.md
├── 📁 公司信息
│   ├── 📄 公司简介.md
│   ├── 📄 企业资质.pdf
│   └── 📄 团队介绍.md
└── 📁 行业知识
    ├── 📄 行业报告2026.pdf
    └── 📄 政策法规.md
```

### 3.2 文档处理流水线

```
文档上传
    │
    ▼
┌──────────┐
│ 格式解析  │ ← PDF/Word/Excel/网页 → 纯文本
└────┬─────┘
     │
     ▼
┌──────────┐
│ 文本清洗  │ ← 去除噪声、标准化格式
└────┬─────┘
     │
     ▼
┌──────────┐
│ 智能切片  │ ← 按语义段落切分，每片 512-1024 tokens
└────┬─────┘   支持递归切片 + 滑动窗口重叠
     │
     ▼
┌──────────┐     ┌──────────────┐
│ 向量化    │────▶│ DeepSeek     │
│ Embedding │     │ Embedding API│
└────┬─────┘     └──────────────┘
     │
     ▼
┌──────────┐
│ 存入     │ ← 向量 + 元数据 + 原文
│ Qdrant   │
└──────────┘
```

### 3.3 RAG 检索流程

```
用户提问: "企业版和专业版有什么区别？"
    │
    ▼
┌──────────┐
│ Query    │ ← 问题向量化
│ Embedding│
└────┬─────┘
     │
     ├──── 语义检索 ──────────────────────┐
     │     (Qdrant 向量相似度 Top-K)      │
     │                                    │
     ├──── 关键词检索 ────────────────┐   │
     │     (Meilisearch BM25)        │   │
     │                                │   │
     ▼                                ▼   ▼
┌──────────┐                    ┌──────────┐
│ 结果融合  │◀───────────────────│ RRF 排序  │
│ & 重排    │                    │ 倒数排名  │
└────┬─────┘                    └──────────┘
     │
     ▼
┌──────────┐
│ 上下文    │ ← 将 Top-5 相关文档片段注入 Prompt
│ 组装     │
└────┬─────┘
     │
     ▼
┌──────────┐     ┌──────────┐
│ DeepSeek │────▶│ 生成回复  │
│ 生成     │     │ + 引用来源│
└──────────┘     └──────────┘

输出示例:
"企业版和专业版的主要区别如下：
 1. 用户数量：企业版无限制，专业版最多50人 [来源: 定价方案.xlsx]
 2. 功能差异：企业版包含高级数据分析... [来源: 产品介绍.pdf]
 3. 技术支持：企业版7×24小时... [来源: 产品介绍.pdf]"
```

### 3.4 FAQ 管理

| 功能 | 说明 |
|------|------|
| 手动添加 | 管理员手动创建问答对 |
| AI 自动生成 | DeepSeek 从文档中自动提取常见问答 |
| 对话挖掘 | 从历史对话中自动发现高频问题 |
| 答案优化 | AI 自动优化回答质量 |
| 效果统计 | 每个FAQ的使用次数、满意度 |

---

## 4. AI 记忆系统

### 4.1 三层记忆架构

```
┌─────────────────────────────────────────────┐
│                 记忆系统                      │
├─────────────┬───────────────┬───────────────┤
│   短期记忆   │   长期记忆     │   共享记忆     │
│  (Session)  │  (Customer)   │  (Team)       │
├─────────────┼───────────────┼───────────────┤
│ 当前会话     │ 客户偏好       │ 产品更新       │
│ 上下文       │ 历史摘要       │ 行业洞察       │
│             │ 个性化画像     │ 最佳实践       │
│             │ 关键事件       │ 竞品动态       │
├─────────────┼───────────────┼───────────────┤
│ 存储: Redis  │ 存储: PgSQL   │ 存储: PgSQL   │
│ TTL: 会话时长 │ + Qdrant     │ + Qdrant     │
│             │ TTL: 永久     │ TTL: 永久     │
│             │ (带衰减)      │ (手动更新)    │
└─────────────┴───────────────┴───────────────┘
```

### 4.2 记忆读写流程

#### 写入记忆
```
每次对话结束后:
  1. DeepSeek 分析对话内容
  2. 提取关键信息:
     - 客户偏好 (喜欢什么/不喜欢什么)
     - 关键需求 (需要什么功能/什么预算)
     - 重要事件 (投诉/表扬/购买)
     - 个人信息 (家庭/爱好/生日)
  3. 生成记忆摘要
  4. 向量化存入 Qdrant
  5. 结构化数据存入 PostgreSQL

Prompt 示例:
"请分析以下客户对话,提取值得记忆的关键信息:
 对话内容: [...]
 
 输出格式:
 {
   preferences: ['偏好A', '偏好B'],
   needs: ['需求A'],
   events: ['事件描述'],
   personal_info: ['信息A'],
   summary: '一句话摘要',
   importance: 0.8
 }"
```

#### 读取记忆
```
新对话开始时:
  1. 获取客户 ID
  2. 从 Redis 加载短期记忆(最近会话)
  3. 从 Qdrant 语义检索相关长期记忆
  4. 加载适用的共享记忆
  5. 组装为上下文注入 Prompt

System Prompt 模板:
"你是{company}的智能客服助手。

关于当前客户的记忆:
- 客户姓名: {name}, 公司: {company}
- 历史偏好: {preferences}
- 上次沟通: {last_summary}
- 待跟进事项: {pending_items}
- 个性化备注: {personal_notes}

行业知识更新:
- {shared_memories}

请基于以上记忆提供个性化服务。"
```

### 4.3 记忆衰减机制

```python
# 记忆重要度衰减公式
importance_score = original_importance × decay_factor ^ (days_since_last_access / 30)

# 示例:
# 原始重要度: 0.9
# 衰减因子: 0.95
# 距上次访问: 60天
# 当前重要度: 0.9 × 0.95^2 = 0.81

# 当重要度 < 0.3 时，记忆被归档
# 当重要度 < 0.1 时，记忆可被清理
# 被访问时重要度重置为原始值
```

---

## 5. 客服团队管理

### 5.1 坐席管理

```
┌─────────────────────────────────────────────────┐
│ 客服管理面板                                      │
├─────────────────────────────────────────────────┤
│ 在线客服 (8/12)                                  │
│ ┌─────────────────────────────────────────────┐ │
│ │ 🟢 王小明  在线  当前会话: 5/8  满意度: 96%  │ │
│ │ 🟢 李小红  在线  当前会话: 3/8  满意度: 94%  │ │
│ │ 🟡 张小华  忙碌  当前会话: 8/8  满意度: 91%  │ │
│ │ 🟢 刘小芳  在线  当前会话: 2/8  满意度: 98%  │ │
│ │ ...                                         │ │
│ └─────────────────────────────────────────────┘ │
│ 离线客服 (4/12)                                  │
│ ⚪ 陈小刚  离线  上次在线: 2小时前               │
│ ...                                              │
├─────────────────────────────────────────────────┤
│ 今日统计                                         │
│ 总会话: 156  已解决: 142  平均响应: 32s          │
│ AI处理: 89(57%)  人工处理: 67(43%)               │
│ 满意度: 94.5%                                    │
└─────────────────────────────────────────────────┘
```

### 5.2 工单系统

```
工单状态流转：
新建 → 已分配 → 处理中 → 待确认 → 已解决 → 已关闭
                  │                     ↑
                  └──── 升级 ──────────┘
                        (超时/复杂)

工单字段：
  - 标题、描述
  - 优先级 (P1紧急/P2高/P3中/P4低)
  - 类型 (咨询/故障/投诉/建议)
  - 关联客户、关联会话
  - 处理人、协助人
  - SLA 截止时间
  - 内部备注
  - 附件
```

### 5.3 SLA 管理

| SLA 等级 | 首次响应 | 解决时限 | 升级规则 |
|---------|---------|---------|---------|
| P1 紧急 | 5 分钟 | 1 小时 | 超时自动升级到主管 |
| P2 高 | 15 分钟 | 4 小时 | 超时通知组长 |
| P3 中 | 30 分钟 | 24 小时 | 超时邮件提醒 |
| P4 低 | 2 小时 | 72 小时 | 超时标记延期 |

### 5.4 质检系统

#### AI 自动质检
```
DeepSeek 分析每次对话:
  评分维度:
    - 专业性 (回答准确度)     权重 30%
    - 服务态度 (礼貌、耐心)   权重 25%
    - 响应速度 (及时性)       权重 20%
    - 问题解决率              权重 15%
    - 规范性 (话术规范)       权重 10%
  
  输出:
    - 综合评分 (0-100)
    - 各维度评分
    - 改进建议
    - 优秀话术提取
```

---

## 6. 客服绩效看板

### 6.1 个人绩效

| 指标 | 说明 | 目标值 |
|------|------|-------|
| 日均会话量 | 每天处理的会话数 | 50+ |
| 平均响应时长 | 首次回复客户的时间 | <30s |
| 平均解决时长 | 从开始到解决的时间 | <10min |
| 客户满意度 | 客户评分平均值 | >95% |
| 一次解决率 | 无需二次跟进的比例 | >80% |
| 转人工率 | AI 转人工的比例（越低越好） | <20% |
| 质检得分 | AI 质检平均分 | >85 |

### 6.2 团队绩效

- 团队排名对比
- 渠道服务质量对比
- 时段分析（高峰/低谷）
- 问题类型分布
- 客户满意度趋势
